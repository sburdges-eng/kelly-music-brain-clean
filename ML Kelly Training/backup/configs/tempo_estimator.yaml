# =============================================================================
# Tempo Estimator Training Configuration
# =============================================================================
# Task: Estimate tempo (BPM) from audio
# Target: Fast inference (<5ms) for real-time tempo detection
# Architecture: CNN + regression head
# =============================================================================

# Model Identity
model_id: tempoestimator
model_type: RTNeural
task: tempo_estimation

# Architecture
# Input: Onset spectrogram (64 bands Ã— 256 frames)
# Output: 1-dim (tempo in BPM, normalized)
input_size: 64
output_size: 1
hidden_layers: [256, 128, 64]
activation: relu
dropout: 0.2

# Use CNN for temporal patterns
architecture_type: cnn
cnn_config:
  in_channels: 1
  conv_layers:
    - {out_channels: 32, kernel_size: [3, 7], stride: 1, padding: [1, 3]}
    - {out_channels: 64, kernel_size: [3, 5], stride: 2, padding: [1, 2]}
    - {out_channels: 128, kernel_size: [3, 3], stride: 2, padding: 1}
  pool_type: adaptive_avg
  fc_layers: [256, 128, 1]

# Data Configuration
data_path: /Volumes/Extreme SSD/kelly-audio-data/raw/tempo
data_version: v1
sample_rate: 22050
n_mels: 64
n_fft: 2048
hop_length: 512
max_duration: 30.0
min_duration: 5.0

# Tempo range
tempo_config:
  min_bpm: 40
  max_bpm: 240
  normalize: true  # Normalize to [0, 1]
  use_log_scale: false

# Split ratios
train_split: 0.8
val_split: 0.1
test_split: 0.1

# Training Parameters (Mac-optimized)
epochs: 100
batch_size: 32
learning_rate: 0.001
optimizer: adam
weight_decay: 0.0001
loss: mse  # Regression
scheduler: cosine
warmup_epochs: 5

# Early stopping
early_stopping_patience: 15
min_delta: 0.001

# Mac-specific settings
device: auto
num_workers: 0
pin_memory: false

# Augmentation
augmentation:
  time_stretch: [0.8, 1.25]  # Changes tempo proportionally
  pitch_shift: [-2, 2]
  noise_injection: 0.01

# Output
output_dir: checkpoints/tempo_estimator
export_onnx: true
export_coreml: true

# Logging
log_interval: 20
save_interval: 10

# Evaluation metrics
metrics:
  - mae_bpm
  - accuracy_4pct  # Within 4% of ground truth
  - accuracy_8pct  # Within 8% (octave error tolerance)

# Metadata
author: ""
notes: "Tempo estimation from onset spectrograms"

